#!/bin/bash

echo "ğŸš€ Iniciando a configuraÃ§Ã£o do projeto..."

# Verifica se Docker e Docker Compose estÃ£o instalados
if ! command -v docker &> /dev/null || ! command -v docker-compose &> /dev/null
then
    echo "âŒ Docker e Docker Compose precisam estar instalados."
    exit 1
fi

# Derruba e recria os containers
echo "ğŸ“¦ Subindo os containers do Docker..."
docker-compose down --remove-orphans
docker-compose up -d --build

# Aguarda o MySQL iniciar
echo "â³ Aguardando MySQL iniciar..."
sleep 10

# Executa os comandos dentro do container da aplicaÃ§Ã£o
echo "ğŸ”§ Rodando setup dentro do container..."
docker exec -it salesflow_php bash -c "
    echo 'ğŸ”‘ Gerando a APP_KEY...'
    php artisan key:generate

    echo 'ğŸ”„ Limpando caches...'
    php artisan cache:clear && php artisan config:clear && php artisan route:clear && php artisan view:clear

    echo 'ğŸ² Rodando as migraÃ§Ãµes...'
    php artisan migrate --force

    echo 'ğŸŒ± Rodando os seeders...'
    php artisan db:seed

    echo 'ğŸ“‚ Ajustando permissÃµes...'
    chmod -R 777 storage bootstrap/cache
"

echo "âœ… ConfiguraÃ§Ã£o concluÃ­da! O projeto estÃ¡ pronto para uso."
